 LOG  ğŸ”— Mapped Gmail to gmail for disconnection
 LOG  ğŸ”Œ Disconnecting gmail integration...
 LOG  ğŸ”„ gmail token expired, attempting refresh...
 LOG  ğŸ“§ Refreshing Gmail token...
 LOG  ğŸ”„ Making gmail token refresh request...
 LOG  ğŸ“¥ gmail token refresh response: {"status": 400, "statusText": ""}
 ERROR  âŒ gmail token refresh failed: {"response_body": "{
  \"error\": \"invalid_request\",
  \"error_description\": \"client_secret is missing.\"
}", "status": 400, "statusText": ""}
 ERROR  âŒ Token refresh failed: [Error: token refresh failed: invalid_request - client_secret is missing.]
 ERROR  ğŸ”´ Error retrieving gmail tokens: [Error: Failed to refresh authentication. Please try signing in again.]
 LOG  âœ… gmail integration disconnected
 LOG  âœ… Gmail integration deactivated in Supabase
 LOG  âœ… Integration 83931f60-5394-4fce-81ce-4fa056203da5 status updated to: inactive
 LOG  ğŸ”— Connecting to service: Gmail
 LOG  ğŸ”— Mapped service name: gmail
 LOG  ğŸš€ Starting integration for Gmail...
 LOG  ğŸ”— Mapped Gmail to gmail
 LOG  âœ… Integration record created with ID: dba289db-ebd5-4681-a652-bec71f766a2e
 LOG  ğŸ”— Starting OAuth flow for gmail...
 LOG  ğŸ”§ gmail OAuth Service initialized
 LOG  ğŸ“§ Starting Gmail OAuth flow...
 LOG  ğŸ“§ Integration ID: dba289db-ebd5-4681-a652-bec71f766a2e
 LOG  ğŸ“§ Opening OAuth URL: https://accounts.google.com/o/oauth2/v2/auth?client_id=66333577628-gnnebnjk57ione1bfphjmfa1vmk9nr9a.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Fhightower-ai.com%2Foauth%2Fgmail%2Fcallback&response_type=code&scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fgmail.modify&state=dba289db-ebd5-4681-a652-bec71f766a2e&access_type=offline&prompt=consent
 LOG  âœ… Opening OAuth URL in browser...
 LOG  âœ… OAuth URL opened successfully
 LOG  âœ… gmail OAuth completed successfully
 LOG  âœ… Integration dba289db-ebd5-4681-a652-bec71f766a2e status updated to: active
 LOG  === DEEP LINK RECEIVED ===
 LOG  Full URL: https://hightower-ai.com/oauth/gmail/callback?state=dba289db-ebd5-4681-a652-bec71f766a2e&code=4/0AVMBsJhxHi69lQgExLC7SMdG-A_Dz8GZMkvrj7QJWDzsFgndFX5BVn-F93vy5BLBdoc9yw&scope=https://www.googleapis.com/auth/gmail.modify
 LOG  URL starts with https:// true
 LOG  URL includes /oauth/ true
 LOG  âœ… Detected OAuth callback - using new OAuth routing system
 LOG  === HANDLING HTTPS OAUTH CALLBACK ===
 LOG  URL: https://hightower-ai.com/oauth/gmail/callback?state=dba289db-ebd5-4681-a652-bec71f766a2e&code=4/0AVMBsJhxHi69lQgExLC7SMdG-A_Dz8GZMkvrj7QJWDzsFgndFX5BVn-F93vy5BLBdoc9yw&scope=https://www.googleapis.com/auth/gmail.modify
 LOG  ğŸ“ Detected service: gmail
 LOG  âœ… Processing gmail HTTPS callback with code and state
 LOG  ğŸ“§ Handling Gmail OAuth callback...
 LOG  ğŸ“§ Integration ID: dba289db-ebd5-4681-a652-bec71f766a2e
 LOG  ğŸ”„ Exchanging code for tokens...
 LOG  ğŸ”„ Making gmail token exchange request...
 LOG  ğŸ“¥ gmail token exchange response: {"status": 200, "statusText": ""}
 LOG  âœ… gmail token exchange successful
 LOG  âœ… Token exchange successful
 LOG  ğŸ” Storing gmail tokens for integration: dba289db-ebd5-4681-a652-bec71f766a2e
 LOG  ğŸ” Token result keys: ["access_token", "expires_in", "refresh_token", "scope", "token_type"]
 LOG  ğŸ” Storage key: gmail_tokens_dba289db-ebd5-4681-a652-bec71f766a2e
 LOG  ğŸ” Token data to store: {
  "accessToken": "ya29.a0AS3H6NwcfXATr6ORZ1PGoVEz8nUTSJEHsn9sbqdTYonHiwyzIrqB4IAeIziypZeCphxWSlrMVOS_9mt6nooOS2xJoMCuO9c_zX6KFKPMbkqFFsFKeOlR2Z782sFWlZN4dIR4-fZa5DS04fGZv1HkVtAru_ITtF_KSRtzZf_IaCgYKAfQSARcSFQHGX2MiJP_sEf2x85dOQI4kaar_5g0175",
  "refreshToken": "1//0fAtQuDp3dE2SCgYIARAAGA8SNwF-L9Ir5V0rLzJXKUho8vzq6DQ9dqtuDZSaDyYJ5K-ZfMonggPTDiJ9O79LYEErX0bWhYuUmAI",
  "expiresAt": "2025-07-17T14:10:22.837Z",
  "integrationId": "dba289db-ebd5-4681-a652-bec71f766a2e",
  "service": "gmail",
  "scope": "https://www.googleapis.com/auth/gmail.modify",
  "storedAt": "2025-07-17T13:10:23.837Z"
}
 LOG  ğŸ” gmail tokens stored securely
 LOG  âœ… Gmail integration saved to Supabase
 LOG  ğŸ” gmail completing integration flow...
 LOG  ğŸ”— Completing integration for gmail
 LOG  ğŸ“ TEXT_INPUT: ========== TEXT MESSAGE PROCESSING ==========
 LOG  ğŸ“ TEXT_INPUT: Processing text message: Let's complete the integration for gmail
 LOG  ğŸ“ TEXT_INPUT: Current voice settings: {
  "deepgramEnabled": false,
  "baseLanguageModel": "claude-sonnet-4-20250514",
  "generalInstructions": "",
  "selectedWakeWord": "BUMBLEBEE",
  "wakeWordSensitivity": 0.1,
  "wakeWordDetectionEnabled": false,
  "selectedDeepgramVoice": "aura-2-mars-en",
  "xaiLiveSearchEnabled": false,
  "xaiLiveSearchSafeSearch": true,
  "xaiLiveSearchSources": [],
  "xaiLiveSearchCountry": "US",
  "xaiLiveSearchXHandles": [],
  "assistantName": "Assistant",
  "wakeWord": "BUMBLEBEE"
}
 LOG  ğŸ• Setting auto-refresh timer for 10 minutes
 LOG  âœ… Integration completion flow triggered for gmail
 LOG  âœ… gmail integration completion flow triggered
 LOG  âœ… Gmail authentication successful
 LOG  ğŸ“ TEXT_INPUT: ========== SENDING TO API ==========
 LOG  ğŸ“ TEXT_INPUT: Sending message to API
 LOG  ğŸ”´ SERVER_API: sendChatRequest called
 LOG  ğŸ”´ SERVER_API: Message: "Let's complete the integration for gmail"
 LOG  ğŸ”´ SERVER_API: Generated request ID: 1752757824626-b7hnd61ia
 LOG  ğŸ“Š REQUEST_STATUS: Setting request ID for polling: 1752757824626-b7hnd61ia
 LOG  ğŸ”´ SERVER_API: Adding delay for Android stability...
 LOG  ğŸ”´ SERVER_API: History[0]: {"content": "Let's complete the integration for gmail", "contentLength": 40, "role": "user", "timestamp": 1752757824162}
 LOG  ğŸ”´ SERVER_API: Full request payload: {
  "message": "Let's complete the integration for gmail",
  "timestamp": 1752757824847,
  "history": [
    {
      "role": "user",
      "content": "Let's complete the integration for gmail",
      "timestamp": 1752757824162,
      "type": "text"
    }
  ],
  "preferences": {
    "voice": "male",
    "response_type": "concise"
  },
  "request_id": "1752757824626-b7hnd61ia"
}
 LOG  ğŸ” API Interceptor: Starting auth check for request to: /api/chat
 LOG  ğŸ“± Platform: android
 LOG  ğŸ” API Interceptor: User check result: User ID: 56a2c117-6486-4ca5-a57d-6c2e877e7083
 LOG  ğŸ” API Interceptor: Session check result: Token exists: true
 LOG  âœ… API Interceptor: Auth token added to request
 LOG  ğŸ“± Android: Token length: 970
 LOG  ğŸ” API Interceptor: Final headers: {"Accept": "application/json, text/plain, */*", "Authorization": "[REDACTED]", "Content-Type": "multipart/form-data"}
 LOG  âœ… API Response Success: 200 /api/chat
 LOG  ğŸ“± Android: API request completed successfully
 LOG  ğŸ”´ SERVER_API: âœ… Server response received
 LOG  API Response:
 {"integration_in_progress": false, "request_id": "1752757824626-b7hnd61ia", "response": "I started working on your Gmail integration setup and was able to fetch some of your emails, including one from cameron@hightower-ai.com. However, I reached the maximum number of actions while trying to complete the full integration process, which includes storing email samples and extracting your contacts. 

The integration is partially set up - I can access your Gmail - but we'll need to continue the setup process to fully complete features like contact extraction and email organization. Would you like to try continuing the setup process?", "settings_updated": false, "timestamp": 1752757974}
 LOG  ğŸ“ TEXT_INPUT: ========== API RESPONSE RECEIVED ==========
 LOG  ğŸ“ TEXT_INPUT: API call duration: 149678 ms
 LOG  ğŸ“ TEXT_INPUT: Received API response
 LOG  ğŸ“ TEXT_INPUT: Response settings_updated flag: false
 LOG  ğŸ“ TEXT_INPUT: Response integration_in_progress flag: false
 LOG  âš™ï¸ TEXT_INPUT: No settings update flag - skipping settings refresh
 LOG  ğŸ”— TEXT_INPUT: No integration build in progress flag - skipping polling
 LOG  ğŸ• Setting auto-refresh timer for 10 minutes
 LOG  ğŸ“ TEXT_INPUT: Response added to chat (no TTS in text mode)
